<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Resume Customizer</title>
    <!-- Add PDF generation library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            padding: 40px;
        }
        
        .upload-section, .job-description-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }
        
        .upload-section:hover, .job-description-section:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.1);
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .icon {
            font-size: 1.3rem;
        }
        
        .file-upload-area {
            border: 3px dashed #bdc3c7;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload-area:hover {
            border-color: #3498db;
            background: #f1f8ff;
        }
        
        .file-upload-area.dragover {
            border-color: #27ae60;
            background: #f0fff0;
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #95a5a6;
            margin-bottom: 15px;
        }
        
        .upload-text {
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .choose-file-btn {
            background: #3498db;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        
        .choose-file-btn:hover {
            background: #2980b9;
        }
        
        .file-info {
            margin-top: 15px;
            padding: 10px;
            background: #e8f5e8;
            border-radius: 5px;
            display: none;
        }
        
        .job-description-textarea {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }
        
        .job-description-textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .action-section {
            grid-column: 1 / -1;
            text-align: center;
            margin-top: 20px;
        }
        
        .process-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        
        .process-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4);
        }
        
        .process-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .tips {
            grid-column: 1 / -1;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .tips h3 {
            color: #d68910;
            margin-bottom: 10px;
        }
        
        .tips ul {
            color: #856404;
            margin-left: 20px;
        }
        
        .tips li {
            margin-bottom: 5px;
        }

        /* NEW: Template Selection Styles */
        .template-selector {
            grid-column: 1 / -1;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            border: 2px solid #e9ecef;
            display: none;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .template-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .template-card:hover {
            border-color: #3498db;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.2);
        }

        .template-card.selected {
            border-color: #28a745;
            background: #f8fff9;
        }

        .template-preview {
            width: 100%;
            height: 200px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #95a5a6;
        }

        .template-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .template-description {
            font-size: 0.9rem;
            color: #6c757d;
        }

        /* Resume Preview Styles */
        .resume-preview {
            grid-column: 1 / -1;
            margin-top: 30px;
            display: none;
        }

        .resume-container {
            background: white;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        /* Modern Template Styles */
        .resume-modern {
            padding: 40px;
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
        }

        .resume-modern .header-section {
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .resume-modern .name {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .resume-modern .contact {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .resume-modern .section {
            margin-bottom: 25px;
        }

        .resume-modern .section-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #3498db;
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }

        .resume-modern .experience-item {
            margin-bottom: 20px;
        }

        .resume-modern .job-title {
            font-weight: bold;
            color: #2c3e50;
        }

        .resume-modern .company {
            color: #3498db;
            font-style: italic;
        }

        .resume-modern .date {
            color: #7f8c8d;
            float: right;
        }

        .resume-modern .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .resume-modern .skill-item {
            background: #ecf0f1;
            padding: 8px 12px;
            border-radius: 5px;
            text-align: center;
            color: #2c3e50;
        }

        /* Export Controls */
        .export-controls {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .export-btn {
            background: #e74c3c;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px 10px;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .export-btn.pdf {
            background: #e74c3c;
        }

        .export-btn.docx {
            background: #2980b9;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }

            .template-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI Resume Customizer</h1>
            <p>Tailor your resume to any job description with AI-powered optimization</p>
        </div>
        
        <div class="main-content">
            <div class="upload-section">
                <h2 class="section-title">
                    <span class="icon">📄</span>
                    Upload Your Resume
                </h2>
                
                <div class="file-upload-area" id="fileUploadArea">
                    <div class="upload-icon">📁</div>
                    <div class="upload-text">
                        Drag and drop your resume here or click to browse
                    </div>
                    <button class="choose-file-btn" onclick="document.getElementById('resumeFile').click()">
                        Choose File
                    </button>
                    <input type="file" id="resumeFile" class="file-input" accept=".pdf,.doc,.docx" onchange="handleFileSelect(this)">
                    
                    <div class="file-info" id="fileInfo">
                        <strong>Selected:</strong> <span id="fileName"></span>
                    </div>
                </div>
                
                <div style="margin-top: 15px; font-size: 0.9rem; color: #7f8c8d;">
                    Supported formats: PDF, DOC, DOCX
                </div>
            </div>
            
            <div class="job-description-section">
                <h2 class="section-title">
                    <span class="icon">💼</span>
                    Job Description
                </h2>
                
                <textarea 
                    class="job-description-textarea" 
                    id="jobDescription"
                    placeholder="Paste the complete job description here...

Include:
• Job title and company
• Required skills and qualifications  
• Job responsibilities
• Experience requirements
• Any specific keywords mentioned

The more detailed the job description, the better your customized resume will be!"
                    oninput="updateProcessButton()"
                ></textarea>
            </div>
            
            <div class="action-section">
                <button class="process-btn" id="processBtn" disabled onclick="processResume()">
                    ✨ Customize My Resume
                </button>
            </div>

            <!-- NEW: Template Selection Section -->
            <div class="template-selector" id="templateSelector">
                <h2 class="section-title">
                    <span class="icon">🎨</span>
                    Choose Resume Template
                </h2>
                
                <div class="template-grid">
                    <div class="template-card" data-template="modern" onclick="selectTemplate('modern')">
                        <div class="template-preview">📋</div>
                        <div class="template-name">Modern Tech</div>
                        <div class="template-description">Clean, ATS-friendly design perfect for tech roles</div>
                    </div>
                    
                    <div class="template-card" data-template="classic" onclick="selectTemplate('classic')">
                        <div class="template-preview">📄</div>
                        <div class="template-name">Classic Corporate</div>
                        <div class="template-description">Traditional format for conservative industries</div>
                    </div>
                    
                    <div class="template-card" data-template="creative" onclick="selectTemplate('creative')">
                        <div class="template-preview">🎨</div>
                        <div class="template-name">Creative Design</div>
                        <div class="template-description">Visual appeal for design and marketing roles</div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="process-btn" onclick="generateResumePreview()" id="previewBtn" disabled>
                        👁️ Preview Resume
                    </button>
                </div>
            </div>

            <!-- NEW: Resume Preview Section -->
            <div class="resume-preview" id="resumePreview">
                <h2 class="section-title">
                    <span class="icon">👁️</span>
                    Resume Preview
                </h2>
                
                <div class="resume-container">
                    <div id="resumeContent" class="resume-modern">
                        <!-- Resume content will be generated here -->
                    </div>
                </div>

                <div class="export-controls">
                    <button class="export-btn pdf" onclick="exportToPDF()">
                        📄 Download PDF
                    </button>
                    <button class="export-btn docx" onclick="exportToDocx()">
                        📝 Download DOCX
                    </button>
                </div>
            </div>
            
            <div class="tips">
                <h3>💡 Pro Tips for Best Results</h3>
                <ul>
                    <li>Use your most recent and complete resume</li>
                    <li>Copy the entire job description, including requirements and nice-to-haves</li>
                    <li>Include company culture information if available</li>
                    <li>Make sure your resume is in a clean, readable format</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        let selectedFile = null;
        let resumeData = null;
        let jobData = null;
        let aiCustomizedData = null;
        let selectedTemplate = 'modern';
        
        // File upload handling
        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileInput = document.getElementById('resumeFile');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        
        // Drag and drop functionality
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('dragover');
        });
        
        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('dragover');
        });
        
        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        fileUploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        function handleFileSelect(input) {
            if (input.files.length > 0) {
                handleFile(input.files[0]);
            }
        }
        
        function handleFile(file) {
            console.log('File selected:', file.name, 'Type:', file.type);
            
            const validTypes = [
                'application/pdf', 
                'application/msword', 
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'application/vnd.ms-word',
                'application/octet-stream'
            ];
            
            const isValidFile = validTypes.includes(file.type) || 
                               file.name.toLowerCase().endsWith('.pdf') ||
                               file.name.toLowerCase().endsWith('.doc') ||
                               file.name.toLowerCase().endsWith('.docx');
            
            if (!isValidFile) {
                alert('Please select a PDF, DOC, or DOCX file.');
                console.log('Invalid file type:', file.type);
                return;
            }
            
            selectedFile = file;
            fileName.textContent = file.name;
            fileInfo.style.display = 'block';
            console.log('File successfully selected:', file.name);
            updateProcessButton();
        }
        
        function updateProcessButton() {
            const jobDescription = document.getElementById('jobDescription').value.trim();
            const processBtn = document.getElementById('processBtn');
            
            if (selectedFile && jobDescription.length > 50) {
                processBtn.disabled = false;
            } else {
                processBtn.disabled = true;
            }
        }
        
        async function processResume() {
            if (!selectedFile) {
                alert('Please upload a resume first.');
                return;
            }
            
            const jobDescription = document.getElementById('jobDescription').value.trim();
            if (jobDescription.length < 50) {
                alert('Please enter a more detailed job description.');
                return;
            }
            
            const processBtn = document.getElementById('processBtn');
            const originalText = processBtn.innerHTML;
            
            try {
                // Show loading state
                processBtn.innerHTML = '⏳ Processing...';
                processBtn.disabled = true;
                
                // Step 1: Upload and parse resume
                console.log('Uploading resume...');
                const formData = new FormData();
                formData.append('file', selectedFile);
                
                const resumeResponse = await fetch('http://localhost:8000/api/upload-resume', {
                    method: 'POST',
                    body: formData
                });
                
                if (!resumeResponse.ok) {
                    throw new Error(`Resume upload failed: ${resumeResponse.status}`);
                }
                
                const resumeDataResult = await resumeResponse.json();
                console.log('Resume processed:', resumeDataResult);
                
                // Step 2: Analyze job description
                console.log('Analyzing job description...');
                const jobFormData = new FormData();
                jobFormData.append('job_description', jobDescription);
                
                const jobResponse = await fetch('http://localhost:8000/api/analyze-job', {
                    method: 'POST',
                    body: jobFormData
                });
                
                if (!jobResponse.ok) {
                    throw new Error(`Job analysis failed: ${jobResponse.status}`);
                }
                
                const jobDataResult = await jobResponse.json();
                console.log('Job analyzed:', jobDataResult);
                
                // Step 3: Show results and template selection
                showResults(resumeDataResult, jobDataResult);
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error processing your request: ${error.message}`);
            } finally {
                // Reset button
                processBtn.innerHTML = originalText;
                processBtn.disabled = false;
            }
        }

        function showResults(resumeDataParam, jobDataParam) {
            // Store globally for AI customization
            resumeData = resumeDataParam;
            jobData = jobDataParam;
            
            // Create results section if it doesn't exist
            let resultsSection = document.getElementById('results');
            if (!resultsSection) {
                resultsSection = document.createElement('div');
                resultsSection.id = 'results';
                resultsSection.style.cssText = `
                    grid-column: 1 / -1;
                    background: #f8f9fa;
                    border-radius: 15px;
                    padding: 30px;
                    margin-top: 30px;
                    border: 2px solid #28a745;
                `;
                document.querySelector('.main-content').appendChild(resultsSection);
            }
            
            // Display results
            resultsSection.innerHTML = `
                <h2 style="color: #28a745; margin-bottom: 20px;">✅ Processing Complete!</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div style="background: white; padding: 20px; border-radius: 10px;">
                        <h3 style="color: #2c3e50;">📄 Resume Analysis</h3>
                        <p><strong>File:</strong> ${resumeData.filename}</p>
                        <p><strong>Size:</strong> ${(resumeData.file_size / 1024).toFixed(1)} KB</p>
                        <p><strong>Text Length:</strong> ${resumeData.full_text_length} characters</p>
                        <div style="margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 5px; font-size: 0.9rem;">
                            <strong>Preview:</strong><br>
                            ${resumeData.extracted_text.substring(0, 200)}...
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px;">
                        <h3 style="color: #2c3e50;">💼 Job Analysis</h3>
                        <p><strong>Word Count:</strong> ${jobData.enhanced_analysis?.basic_metrics?.word_count || jobData.analysis?.word_count || 'N/A'}</p>
                        <p><strong>Experience Level:</strong> ${jobData.enhanced_analysis?.basic_metrics?.detected_experience_level || jobData.analysis?.estimated_experience_level || 'N/A'}</p>
                        <p><strong>Found Skills:</strong> ${jobData.enhanced_analysis?.nlp_analysis?.entities?.technologies?.join(', ') || jobData.analysis?.found_skills?.join(', ') || 'None detected'}</p>
                        <p><strong>Sentiment:</strong> ${jobData.enhanced_analysis?.nlp_analysis?.sentiment?.tone || 'N/A'}</p>
                        <p><strong>Readability:</strong> ${jobData.enhanced_analysis?.nlp_analysis?.readability?.complexity || 'N/A'}</p>
                        <div style="margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 5px; font-size: 0.9rem;">
                            <strong>Preview:</strong><br>
                            ${jobData.job_description_preview}
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="customizeWithAI()" style="
                        background: linear-gradient(45deg, #8e44ad, #9b59b6);
                        color: white;
                        padding: 15px 30px;
                        border: none;
                        border-radius: 25px;
                        font-size: 1.1rem;
                        font-weight: 600;
                        cursor: pointer;
                        margin: 10px;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        🤖 Customize Resume with AI
                    </button>
                    
                    <div id="aiResults" style="margin-top: 20px;"></div>
                </div>
            `;
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // AI Customization Function
        async function customizeWithAI() {
            if (!resumeData || !jobData) {
                alert('Please upload a resume and analyze a job description first!');
                return;
            }
            
            const aiResultsDiv = document.getElementById('aiResults');
            const customizeBtn = event.target;
            const originalText = customizeBtn.innerHTML;
            
            try {
                customizeBtn.innerHTML = '🤖 AI is working magic...';
                customizeBtn.disabled = true;
                
                const formData = new FormData();
                formData.append('resume_text', resumeData.extracted_text);
                formData.append('job_description', document.getElementById('jobDescription').value);
                formData.append('customization_level', 'moderate');
                
                const response = await fetch('http://localhost:8000/api/customize-resume', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`AI customization failed: ${response.status}`);
                }
                
                const aiResult = await response.json();
                console.log('AI Customization Result:', aiResult);
                
                // Store AI data globally
                aiCustomizedData = aiResult;
                
                // Show template selection
                showTemplateSelection();
                
            } catch (error) {
                console.error('AI Customization Error:', error);
                aiResultsDiv.innerHTML = `
                    <div style="background: #ffe6e6; padding: 20px; border-radius: 10px; border: 2px solid #e74c3c;">
                        <h3 style="color: #e74c3c;">⚠️ AI Customization Error</h3>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            } finally {
                customizeBtn.innerHTML = originalText;
                customizeBtn.disabled = false;
            }
        }

        // NEW: Template Selection Functions
        function showTemplateSelection() {
            const templateSelector = document.getElementById('templateSelector');
            templateSelector.style.display = 'block';
            templateSelector.scrollIntoView({ behavior: 'smooth' });
            
            // Select modern template by default
            selectTemplate('modern');
        }

        function selectTemplate(templateName) {
            // Remove previous selection
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select new template
            document.querySelector(`[data-template="${templateName}"]`).classList.add('selected');
            selectedTemplate = templateName;
            
            // Enable preview button
            document.getElementById('previewBtn').disabled = false;
        }

        function generateResumePreview() {
            if (!aiCustomizedData) {
                alert('Please customize your resume with AI first!');
                return;
            }

            const resumePreview = document.getElementById('resumePreview');
            const resumeContent = document.getElementById('resumeContent');
            
            // Parse AI customized content
            let parsedContent;
            try {
                parsedContent = JSON.parse(aiCustomizedData.customized_content);
            } catch (e) {
                // Fallback if JSON parsing fails
                parsedContent = {
                    customized_summary: "AI-optimized professional summary",
                    optimized_experience: [
                        {
                            title: "Recent Experience",
                            company: "Previous Company",
                            description: aiCustomizedData.customized_content.substring(0, 200) + "..."
                        }
                    ],
                    prioritized_skills: ["AI", "Data Analysis", "Problem Solving"]
                };
            }

            // Generate resume based on selected template
            generateResumeHTML(parsedContent, selectedTemplate);
            
            // Show preview
            resumePreview.style.display = 'block';
            resumePreview.scrollIntoView({ behavior: 'smooth' });
        }

        function generateResumeHTML(content, template) {
            const resumeContent = document.getElementById('resumeContent');
            
            if (template === 'modern') {
                resumeContent.innerHTML = generateModernTemplate(content);
                resumeContent.className = 'resume-modern';
            } else if (template === 'classic') {
                resumeContent.innerHTML = generateClassicTemplate(content);
                resumeContent.className = 'resume-classic';
            } else if (template === 'creative') {
                resumeContent.innerHTML = generateCreativeTemplate(content);
                resumeContent.className = 'resume-creative';
            }
        }

        function generateModernTemplate(content) {
            const skills = Array.isArray(content.prioritized_skills) 
                ? content.prioritized_skills 
                : ['Data Analysis', 'Problem Solving', 'Communication'];
                
            const experiences = Array.isArray(content.optimized_experience)
                ? content.optimized_experience
                : [{ title: "Professional Experience", company: "Previous Role", description: "Key achievements and responsibilities" }];

            return `
                <div class="header-section">
                    <div class="name">John Doe</div>
                    <div class="contact">
                        john.doe@email.com | (555) 123-4567 | LinkedIn: /in/johndoe
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">Professional Summary</div>
                    <p>${content.customized_summary || 'AI-optimized professional summary tailored for this specific role.'}</p>
                </div>

                <div class="section">
                    <div class="section-title">Experience</div>
                    ${experiences.map(exp => `
                        <div class="experience-item">
                            <div class="job-title">${exp.title || 'Professional Role'}</div>
                            <div class="company">${exp.company || 'Company Name'} <span class="date">2022 - Present</span></div>
                            <ul style="margin-top: 10px;">
                                <li>${exp.description || 'Key achievements and responsibilities in this role.'}</li>
                                <li>Collaborated with cross-functional teams to deliver high-impact projects</li>
                                <li>Implemented data-driven solutions that improved efficiency by 25%</li>
                            </ul>
                        </div>
                    `).join('')}
                </div>

                <div class="section">
                    <div class="section-title">Skills</div>
                    <div class="skills-grid">
                        ${skills.map(skill => `<div class="skill-item">${skill}</div>`).join('')}
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">Education</div>
                    <div class="experience-item">
                        <div class="job-title">Master of Business Analytics</div>
                        <div class="company">University Name <span class="date">2024</span></div>
                    </div>
                </div>
            `;
        }

        function generateClassicTemplate(content) {
            return `
                <div style="text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px;">
                    <h1 style="margin: 0; font-size: 2rem; color: #333;">JOHN DOE</h1>
                    <p style="margin: 10px 0 0 0; color: #666;">john.doe@email.com | (555) 123-4567</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h2 style="color: #333; border-bottom: 1px solid #ccc; padding-bottom: 5px;">PROFESSIONAL SUMMARY</h2>
                    <p style="margin-top: 10px; line-height: 1.6;">${content.customized_summary || 'Professional summary tailored for the target role.'}</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h2 style="color: #333; border-bottom: 1px solid #ccc; padding-bottom: 5px;">EXPERIENCE</h2>
                    <div style="margin-top: 15px;">
                        <p style="font-weight: bold; margin: 0;">Senior Professional | Company Name</p>
                        <p style="margin: 5px 0; color: #666; font-style: italic;">2022 - Present</p>
                        <ul style="margin-top: 10px;">
                            <li>Led strategic initiatives that improved organizational efficiency</li>
                            <li>Managed cross-functional teams and delivered key projects</li>
                            <li>Implemented data-driven solutions for business optimization</li>
                        </ul>
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <h2 style="color: #333; border-bottom: 1px solid #ccc; padding-bottom: 5px;">SKILLS</h2>
                    <p style="margin-top: 10px; line-height: 1.8;">
                        ${(content.prioritized_skills || ['Data Analysis', 'Project Management', 'Strategic Planning']).join(' • ')}
                    </p>
                </div>

                <div>
                    <h2 style="color: #333; border-bottom: 1px solid #ccc; padding-bottom: 5px;">EDUCATION</h2>
                    <p style="margin-top: 10px; font-weight: bold;">Master of Business Analytics</p>
                    <p style="margin: 5px 0; color: #666;">University Name, 2024</p>
                </div>
            `;
        }

        function generateCreativeTemplate(content) {
            return `
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; margin: -40px -40px 30px -40px;">
                    <h1 style="margin: 0; font-size: 2.5rem; font-weight: bold;">JOHN DOE</h1>
                    <p style="margin: 10px 0 0 0; font-size: 1.1rem; opacity: 0.9;">Creative Professional</p>
                    <p style="margin: 5px 0 0 0; opacity: 0.8;">john.doe@email.com | (555) 123-4567</p>
                </div>

                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
                    <div>
                        <div style="margin-bottom: 25px;">
                            <h2 style="color: #667eea; font-size: 1.3rem; margin-bottom: 15px;">💫 ABOUT ME</h2>
                            <p style="line-height: 1.6; color: #333;">${content.customized_summary || 'Creative professional with a passion for innovation and design-driven solutions.'}</p>
                        </div>

                        <div style="margin-bottom: 25px;">
                            <h2 style="color: #667eea; font-size: 1.3rem; margin-bottom: 15px;">🚀 EXPERIENCE</h2>
                            <div style="border-left: 3px solid #667eea; padding-left: 20px; margin-left: 10px;">
                                <h3 style="margin: 0; color: #333;">Creative Director</h3>
                                <p style="margin: 5px 0; color: #666; font-style: italic;">Innovation Company • 2022 - Present</p>
                                <ul style="margin-top: 10px; color: #333;">
                                    <li>Spearheaded creative campaigns that increased engagement by 40%</li>
                                    <li>Led design thinking workshops for cross-functional teams</li>
                                    <li>Developed innovative solutions for complex design challenges</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h2 style="color: #667eea; font-size: 1.3rem; margin-bottom: 15px;">⚡ SKILLS</h2>
                            ${(content.prioritized_skills || ['Creative Design', 'Innovation', 'Leadership']).map(skill => 
                                `<div style="background: #667eea; color: white; padding: 8px 12px; margin: 5px 0; border-radius: 20px; text-align: center; font-size: 0.9rem;">${skill}</div>`
                            ).join('')}
                        </div>

                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                            <h2 style="color: #667eea; font-size: 1.3rem; margin-bottom: 15px;">🎓 EDUCATION</h2>
                            <p style="font-weight: bold; margin: 0; color: #333;">Master of Business Analytics</p>
                            <p style="margin: 5px 0; color: #666;">University Name</p>
                            <p style="margin: 5px 0; color: #666;">2024</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Export Functions
        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const resumeElement = document.getElementById('resumeContent');
            
            try {
                const canvas = await html2canvas(resumeElement, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true
                });
                
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save('AI-Customized-Resume.pdf');
                
                // Show success message
                alert('✅ PDF downloaded successfully!');
                
            } catch (error) {
                console.error('PDF generation error:', error);
                alert('❌ Error generating PDF. Please try again.');
            }
        }

        function exportToDocx() {
            // Simple DOCX export (placeholder - would need proper library for full DOCX)
            const resumeContent = document.getElementById('resumeContent').innerText;
            const blob = new Blob([resumeContent], { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'AI-Customized-Resume.docx';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('✅ DOCX file downloaded! (Note: Advanced formatting may require manual adjustment)');
        }
        
        // Auto-resize textarea
        const textarea = document.getElementById('jobDescription');
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
    </script>
</body>
</html>
